"use strict";(self.webpackChunkmy_angular=self.webpackChunkmy_angular||[]).push([[645],{5645:(ke,h,r)=>{r.r(h),r.d(h,{WelcomeModule:()=>be});var g=r(6671),f=r(5861),a=r(433),z=r(7910),e=r(4650),v=r(529),F=r(9651),x=r(387),O=r(7579),W=r(4986),S=r(5963);function p(n=0,s=W.z){return n<0&&(n=0),(0,S.H)(n,n,s)}let J=(()=>{class n{constructor(){this.connectSuccess=!1,this.period=6e5,this.serverTimeoutSubscription=null,this.reconnectFlag=!1,this.reconnectPeriod=5e3,this.reconnectSubscription=null,this.runTimePeriod=6e5,this.messageSubject=new O.x,console.log("\u5f00\u59cb\u5fc3\u8df3\u68c0\u6d4b"),this.heartCheckStart(),this.calcRunTime()}heartCheckStart(){this.serverTimeoutSubscription=p(this.period).subscribe(t=>{null!==this.webSocket&&1===this.webSocket.readyState?console.log(t,"\u8fde\u63a5\u72b6\u6001\uff0c\u53d1\u9001\u6d88\u606f\u4fdd\u6301\u8fde\u63a5"):(this.heartCheckStop(),this.reconnect(),console.log("\u8fde\u63a5\u5df2\u65ad\u5f00, \u91cd\u65b0\u8fde\u63a5"))})}heartCheckStop(){typeof this.serverTimeoutSubscription<"u"&&null!==this.serverTimeoutSubscription&&this.serverTimeoutSubscription.unsubscribe()}reconnect(){var t=this;if(this.connectSuccess)return this.stopReconnect(),void console.log("\u5df2\u7ecf\u8fde\u63a5\u6210\u529f, \u505c\u6b62\u91cd\u8fde");this.reconnectFlag?console.log("\u6b63\u5728\u91cd\u8fde, \u76f4\u63a5\u8fd4\u56de"):(this.reconnectFlag=!0,this.reconnectSubscription=p(this.reconnectPeriod).subscribe(function(){var o=(0,f.Z)(function*(i){console.log(`\u91cd\u8fde: ${i}\u6b21`),t.connect(t.url)});return function(i){return o.apply(this,arguments)}}()))}stopReconnect(){this.reconnectFlag=!1,typeof this.reconnectSubscription<"u"&&null!==this.reconnectSubscription&&this.reconnectSubscription.unsubscribe()}connect(t){return t&&(this.url=t),this.createWebSocket(),this.messageSubject}createWebSocket(){this.webSocket=new WebSocket(this.url),this.webSocket.onopen=t=>this.onOpen(t),this.webSocket.onmessage=t=>this.onMessage(t),this.webSocket.onclose=t=>this.onClose(t),this.webSocket.onerror=t=>this.onError(t)}onOpen(t){console.log("WebSocket\u670d\u52a1\u8fde\u63a5\u6210\u529f\uff01"),this.connectSuccess=!0,this.reconnectFlag&&(this.stopReconnect(),this.heartCheckStart(),this.calcRunTime())}onMessage(t){console.log("\u63a5\u6536\u670d\u52a1\u7aef\u6d88\u606f: ",t.data),this.messageSubject.next(t.data)}onClose(t){console.log("WebSocket\u670d\u52a1\u8fde\u63a5\u65ad\u5f00\uff01",t),this.connectSuccess=!1,this.webSocket.close(),this.reconnect(),this.stopRunTime()}onError(t){console.log("WebSocket\u670d\u52a1\u53d1\u751f\u9519\u8bef\uff01",t),this.connectSuccess=!1}calcRunTime(){this.runTimeSubscription=p(this.runTimePeriod).subscribe(t=>{console.log(`\u8fd0\u884c\u65f6\u95f4: ${t}\u5206\u949f`)})}stopRunTime(){typeof this.runTimeSubscription<"u"&&null!==this.runTimeSubscription&&this.runTimeSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var C=r(6895),T=r(5156),Z=r(3679),m=r(6704),u=r(5e3),q=r(7096),b=r(8231),k=r(834),M=r(6616),U=r(7044),E=r(1811),N=r(5635),y=r(2577),B=r(9597),D=r(6672);function V(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"input",29),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw().$implicit;return e.KtG(l.userNo=i)}),e.qZA()}if(2&n){const t=e.oxw().$implicit;e.Q6J("ngModel",t.userNo)}}function w(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"a",32),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,l=e.oxw();return e.KtG(l.showLogList(i))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(t.userNo)}}function I(n,s){if(1&n&&e._uU(0),2&n){const t=e.oxw(2).$implicit;e.Oqu(t.userNo)}}function Q(n,s){if(1&n&&(e.YNc(0,w,2,1,"a",30),e.YNc(1,I,1,1,"ng-template",null,31,e.W1O)),2&n){const t=e.MAs(2),o=e.oxw().$implicit;e.Q6J("ngIf",1===o.status)("ngIfElse",t)}}function $(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"input",33),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw().$implicit;return e.KtG(l.username=i)}),e.qZA()}if(2&n){const t=e.oxw().$implicit;e.Q6J("ngModel",t.username)}}function Y(n,s){if(1&n&&e._uU(0),2&n){const t=e.oxw().$implicit;e.Oqu(t.username)}}function P(n,s){if(1&n&&e._UZ(0,"nz-option",34),2&n){const t=s.$implicit;e.Q6J("nzLabel",t.address)("nzValue",t)}}function L(n,s){1&n&&e._UZ(0,"span")}function R(n,s){if(1&n&&(e.TgZ(0,"nz-tag",37),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(null==t||null==t.staffClock?null:t.staffClock.clockTimeMin)}}function H(n,s){if(1&n&&(e.TgZ(0,"nz-tag",38),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(null==t||null==t.staffClock?null:t.staffClock.clockTimeMin)}}function G(n,s){if(1&n&&(e.YNc(0,R,2,1,"nz-tag",35),e.YNc(1,H,2,1,"ng-template",null,36,e.W1O)),2&n){const t=e.MAs(2),o=e.oxw().$implicit;e.Q6J("ngIf",611===(null==o||null==o.staffClock?null:o.staffClock.clockWorkOnStatus))("ngIfElse",t)}}function j(n,s){1&n&&e._UZ(0,"span")}function K(n,s){if(1&n&&(e.TgZ(0,"nz-tag",37),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(null==t||null==t.staffClock?null:t.staffClock.clockTimeMax)}}function X(n,s){if(1&n&&(e.TgZ(0,"nz-tag",38),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(null==t||null==t.staffClock?null:t.staffClock.clockTimeMax)}}function ee(n,s){if(1&n&&(e.YNc(0,K,2,1,"nz-tag",35),e.YNc(1,X,2,1,"ng-template",null,39,e.W1O)),2&n){const t=e.MAs(2),o=e.oxw().$implicit;e.Q6J("ngIf",611===(null==o||null==o.staffClock?null:o.staffClock.clockWorkOffStatus))("ngIfElse",t)}}function te(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"button",40),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw();return e.KtG(l.gotoWork(i))}),e._uU(2,"\u6253\u5361"),e.qZA(),e._UZ(3,"nz-divider",1),e.TgZ(4,"button",40),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw();return e.KtG(l.repairWork(i))}),e._uU(5,"\u8865\u5361"),e.qZA(),e._UZ(6,"nz-divider",1),e.TgZ(7,"button",40),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw();return e.KtG(l.showDeviceList(i))}),e._uU(8,"\u67e5\u770b\u8bbe\u5907"),e.qZA()()}}function ne(n,s){if(1&n&&e._UZ(0,"nz-alert",41),2&n){const t=e.oxw().$implicit;e.Q6J("nzMessage",t.message)}}function oe(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td",17),e.NdJ("nzCheckedChange",function(i){const c=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.onItemChecked(c.userNo,i))}),e.qZA(),e.TgZ(2,"td"),e.YNc(3,V,1,1,"input",18),e.YNc(4,Q,3,2,"ng-template",null,19,e.W1O),e.qZA(),e.TgZ(6,"td"),e.YNc(7,$,1,1,"input",20),e.YNc(8,Y,1,1,"ng-template",null,21,e.W1O),e.qZA(),e.TgZ(10,"td")(11,"nz-select",22),e.NdJ("ngModelChange",function(i){const c=e.CHM(t).$implicit;return e.KtG(c.addr=i)}),e.YNc(12,P,1,2,"nz-option",23),e.qZA()(),e.TgZ(13,"td"),e.YNc(14,L,1,0,"span",24),e.YNc(15,G,3,2,"ng-template",null,25,e.W1O),e.qZA(),e.TgZ(17,"td"),e.YNc(18,j,1,0,"span",24),e.YNc(19,ee,3,2,"ng-template",null,26,e.W1O),e.qZA(),e.TgZ(21,"td")(22,"nz-date-picker",27),e.NdJ("ngModelChange",function(i){const c=e.CHM(t).$implicit;return e.KtG(c.clockTimeOfDate=i)}),e.qZA()(),e.TgZ(23,"td"),e.YNc(24,te,9,0,"div",24),e.YNc(25,ne,1,1,"ng-template",null,28,e.W1O),e.qZA()()}if(2&n){const t=s.$implicit,o=e.MAs(5),i=e.MAs(9),l=e.MAs(16),c=e.MAs(20),d=e.MAs(26),_=e.oxw();e.xp6(1),e.Q6J("nzChecked",_.setOfCheckedId.has(t.userNo)),e.xp6(2),e.Q6J("ngIf",t.edited)("ngIfElse",o),e.xp6(4),e.Q6J("ngIf",t.edited)("ngIfElse",i),e.xp6(4),e.Q6J("ngModel",t.addr)("nzDropdownMatchSelectWidth",!1)("compareWith",_.compareAddrFn),e.xp6(1),e.Q6J("ngForOf",_.addresses),e.xp6(2),e.Q6J("ngIf",null===(null==t||null==t.staffClock?null:t.staffClock.clockWorkOnStatus))("ngIfElse",l),e.xp6(4),e.Q6J("ngIf",null===(null==t||null==t.staffClock?null:t.staffClock.clockWorkOffStatus))("ngIfElse",c),e.xp6(4),e.Q6J("ngModel",t.clockTimeOfDate),e.xp6(2),e.Q6J("ngIf",1===t.status)("ngIfElse",d)}}function ie(n,s){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.Oqu(t)}}function le(n,s){1&n&&(e.ynx(0),e._uU(1,"cron\u8868\u8fbe\u5f0f\u5fc5\u987b\u586b!"),e.BQk())}function se(n,s){1&n&&e.YNc(0,le,2,0,"ng-container",47),2&n&&e.Q6J("ngIf",s.$implicit.hasError("required"))}function re(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"form",42)(2,"nz-form-item"),e.YNc(3,ie,2,1,"div",12),e.qZA(),e.TgZ(4,"nz-form-item")(5,"nz-form-label",43),e._uU(6,"cron\u8868\u8fbe\u5f0f"),e.qZA(),e.TgZ(7,"nz-form-control",44),e._UZ(8,"input",45),e.YNc(9,se,1,1,"ng-template",null,46,e.W1O),e.qZA()()(),e.BQk()),2&n){const t=e.MAs(10),o=e.oxw();e.xp6(1),e.Q6J("formGroup",o.validateJobForm),e.xp6(2),e.Q6J("ngForOf",o.title.split(";")),e.xp6(4),e.Q6J("nzErrorTip",t)}}function ce(n,s){1&n&&(e.ynx(0),e._uU(1,"\u8bf7\u8f93\u5165\u7ecf\u5ea6!"),e.BQk())}function ae(n,s){1&n&&e.YNc(0,ce,2,0,"ng-container",47),2&n&&e.Q6J("ngIf",s.$implicit.hasError("required"))}function ue(n,s){1&n&&(e.ynx(0),e._uU(1,"\u8bf7\u8f93\u5165\u7eac\u5ea6!"),e.BQk())}function de(n,s){1&n&&e.YNc(0,ue,2,0,"ng-container",47),2&n&&e.Q6J("ngIf",s.$implicit.hasError("required"))}function _e(n,s){1&n&&(e.ynx(0),e._uU(1,"\u8bf7\u8f93\u5165\u5730\u5740!"),e.BQk())}function me(n,s){1&n&&e.YNc(0,_e,2,0,"ng-container",47),2&n&&e.Q6J("ngIf",s.$implicit.hasError("required"))}function pe(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"form",42)(2,"nz-form-item")(3,"nz-form-label",43),e._uU(4,"\u7ecf\u5ea6"),e.qZA(),e.TgZ(5,"nz-form-control",44),e._UZ(6,"nz-input-number",48),e.YNc(7,ae,1,1,"ng-template",null,49,e.W1O),e.qZA()(),e.TgZ(9,"nz-form-item")(10,"nz-form-label",43),e._uU(11,"\u7eac\u5ea6"),e.qZA(),e.TgZ(12,"nz-form-control",44),e._UZ(13,"nz-input-number",50),e.YNc(14,de,1,1,"ng-template",null,51,e.W1O),e.qZA()(),e.TgZ(16,"nz-form-item")(17,"nz-form-label",43),e._uU(18,"\u5730\u5740"),e.qZA(),e.TgZ(19,"nz-form-control",44),e._UZ(20,"input",52),e.YNc(21,me,1,1,"ng-template",null,53,e.W1O),e.qZA()()(),e.BQk()),2&n){const t=e.MAs(8),o=e.MAs(15),i=e.MAs(22),l=e.oxw();e.xp6(1),e.Q6J("formGroup",l.validateAddrForm),e.xp6(4),e.Q6J("nzErrorTip",t),e.xp6(1),e.Q6J("nzPrecision",7)("nzMin",0),e.xp6(6),e.Q6J("nzErrorTip",o),e.xp6(1),e.Q6J("nzPrecision",7)("nzMin",0),e.xp6(6),e.Q6J("nzErrorTip",i)}}function he(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e._uU(20),e.qZA(),e.TgZ(21,"td")(22,"button",40),e.NdJ("click",function(){const l=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.resetBindDevice(l))}),e._uU(23,"\u91cd\u65b0\u7ed1\u5b9a"),e.qZA()()()}if(2&n){const t=s.$implicit;e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.bindDeviceId),e.xp6(2),e.Oqu(t.deviceId),e.xp6(2),e.Oqu(t.model),e.xp6(2),e.Oqu(t.systemName),e.xp6(2),e.Oqu(t.systemVersion),e.xp6(2),e.Oqu(t.resolution),e.xp6(2),e.Oqu(t.pushId),e.xp6(2),e.Oqu(t.createTime),e.xp6(2),e.Oqu(t.updateTime)}}const A=function(){return{y:"600px"}};function ge(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"nz-table",54,5)(3,"thead")(4,"tr")(5,"th",55),e._uU(6,"ID"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"\u7ed1\u5b9a\u8bbe\u5907\u6807\u8bc6"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"\u624b\u673a\u552f\u4e00\u6807\u8bc6"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"\u673a\u578b"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"OS"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"OS\u7248\u672c"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"\u5206\u8fa8\u7387"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"\u8bbe\u5907\u63a8\u9001ID"),e.qZA(),e.TgZ(21,"th",56),e._uU(22,"\u521b\u5efa\u65f6\u95f4"),e.qZA(),e.TgZ(23,"th",56),e._uU(24,"\u66f4\u65b0\u65f6\u95f4"),e.qZA(),e.TgZ(25,"th",56),e._uU(26,"\u64cd\u4f5c"),e.qZA()()(),e.TgZ(27,"tbody"),e.YNc(28,he,24,10,"tr",12),e.qZA()(),e.BQk()),2&n){const t=e.MAs(2),o=e.oxw();e.xp6(1),e.Q6J("nzData",o.deviList)("nzScroll",e.DdM(5,A))("nzFrontPagination",!1)("nzShowPagination",!1),e.xp6(27),e.Q6J("ngForOf",t.data)}}function fe(n,s){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA()()),2&n){const t=s.$implicit;e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.staff_no),e.xp6(2),e.Oqu(t.clock_time),e.xp6(2),e.Oqu(t.create_time),e.xp6(2),e.Oqu(t.longitude),e.xp6(2),e.Oqu(t.latitude),e.xp6(2),e.Oqu(t.address),e.xp6(2),e.Oqu(0===t.clock_type?"OA\u6253\u5361":"\u5ba1\u6279\u8865\u5361")}}function ze(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"nz-range-picker",57),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.current.dateRange=i)}),e.qZA(),e._UZ(2,"nz-divider",1),e.TgZ(3,"button",0),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showLogList(i.current))}),e._uU(4,"\u67e5\u8be2"),e.qZA(),e._UZ(5,"nz-divider",3),e.TgZ(6,"nz-table",58,5)(8,"thead")(9,"tr")(10,"th",56),e._uU(11,"\u4e3b\u952e"),e.qZA(),e.TgZ(12,"th",56),e._uU(13,"\u5458\u5de5\u7f16\u53f7"),e.qZA(),e.TgZ(14,"th",8),e._uU(15,"\u6253\u5361\u65f6\u95f4"),e.qZA(),e.TgZ(16,"th",8),e._uU(17,"\u521b\u5efa\u65f6\u95f4"),e.qZA(),e.TgZ(18,"th",56),e._uU(19,"\u7ecf\u5ea6"),e.qZA(),e.TgZ(20,"th",56),e._uU(21,"\u7eac\u5ea6"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"\u6253\u5361\u5730\u5740"),e.qZA(),e.TgZ(24,"th",56),e._uU(25,"\u6253\u5361\u7c7b\u578b"),e.qZA()()(),e.TgZ(26,"tbody"),e.YNc(27,fe,17,8,"tr",12),e.qZA()(),e.BQk()}if(2&n){const t=e.MAs(7),o=e.oxw();e.xp6(1),e.Q6J("ngModel",o.current.dateRange),e.xp6(5),e.Q6J("nzData",o.logList)("nzScroll",e.DdM(4,A)),e.xp6(21),e.Q6J("ngForOf",t.data)}}const Ce=[{path:"",component:(()=>{class n{constructor(t,o,i,l,c){this.http=t,this.messageService=o,this.notificationService=i,this.fb=l,this.wsService=c,this.isLogVisible=!1,this.isAddrVisible=!1,this.isDeviVisible=!1,this.isJobVisible=!1,this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.compareAddrFn=(d,_)=>d&&_?d.id===_.id:d===_,this.validateAddrForm=this.fb.group({address:[null,[a.kI.required]],longitude:[null,[a.kI.required]],latitude:[null,[a.kI.required]],id:null}),this.validateJobForm=this.fb.group({cronExpression:[null,[a.kI.required]]})}ngOnInit(){var t=this;return(0,f.Z)(function*(){t.addresses=(yield t.http.get("/hello/addresses").toPromise()).data,t.users=(yield t.http.get("/hello/users").toPromise()).data,t.users.forEach(i=>t.initStaffClockV1(i)),t.http.get("/hello/triggers").subscribe(({status:i,message:l})=>{1===i&&t.notificationService.info("\u5b9a\u65f6\u4efb\u52a1",l,{nzPlacement:"bottomRight"})});const o=(yield t.http.get("/hello/wsurl").toPromise()).data;t.wsService.connect(o).subscribe(i=>{t.initStaffClockV2(t.users.find(({userNo:l})=>l===i))})})()}initStaffClockV1(t){this.http.post("/hello/initstaffclock",t).subscribe(({message:o,status:i,data:l})=>{t.message=o,t.status=i,t.staffClock=l,t.addr=this.addresses[0]})}initStaffClockV2(t){this.http.post("/hello/initstaffclock",t).subscribe(({message:o,status:i,data:l})=>{t.message=o,t.status=i,t.staffClock=l})}openUser(){const t=this.users.map(({userNo:i})=>+i),o=`${Math.max(...t)+1}`;this.users.push({userNo:o,username:null,addr:this.addresses[0],status:1,edited:!0}),this.users=this.users.slice(),this.refreshCheckedStatus()}gotoWork(t){if(!t.userNo||0===t.userNo.length)return void this.notificationService.error("\u64cd\u4f5c\u63d0\u793a","\u8bf7\u8f93\u5165\u5458\u5de5\u7f16\u53f7!");if(!t.username||0===t.username.length)return void this.notificationService.error("\u64cd\u4f5c\u63d0\u793a","\u8bf7\u8f93\u5165\u5458\u5de5\u59d3\u540d!");const o={...t,...t.addr};o.addr=null,o.staffClock=null,this.http.post("/hello/v1/userloginandstaffclock",o).subscribe(({message:i,status:l,data:c})=>{t.message=i,t.status=l,t.staffClock=c})}repairWork(t){if(!t.userNo||0===t.userNo.length)return void this.notificationService.error("\u64cd\u4f5c\u63d0\u793a","\u8bf7\u8f93\u5165\u5458\u5de5\u7f16\u53f7!");if(!t.username||0===t.username.length)return void this.notificationService.error("\u64cd\u4f5c\u63d0\u793a","\u8bf7\u8f93\u5165\u5458\u5de5\u59d3\u540d!");if(!t.clockTimeOfDate)return void this.notificationService.error("\u64cd\u4f5c\u63d0\u793a","\u8bf7\u9009\u62e9\u65e5\u671f!");t.clockTime=(0,z.Z)(t.clockTimeOfDate,"yyyy-MM-dd HH:mm:ss");const o={...t,...t.addr};o.addr=null,o.staffClock=null,this.http.post("/hello/v2/userloginandstaffclock",o).subscribe(({status:i,message:l})=>{0===i?this.notificationService.error("\u64cd\u4f5c\u63d0\u793a",l):(this.notificationService.success("\u64cd\u4f5c\u63d0\u793a",`[ ${t.userNo} - ${t.username} ] \u8865\u5361\u6210\u529f`),this.initStaffClockV2(t))})}showDeviceList(t){this.http.post("/hello/selectdevicelist",t).subscribe(({data:o})=>{this.deviList=o.items||[],this.title=`${t.username} - \u8bbe\u5907\u7ed1\u5b9a\u8bb0\u5f55`,this.isDeviVisible=!0})}resetBindDevice(t){const o=Object.entries(t).filter(i=>!!i[1]).map(i=>i.join("=")).join("&");this.http.post("/hello/resetbinddevice",o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).subscribe(({data:i})=>{this.deviList=i.items||[]})}showLogList(t){this.current=t,this.current.dateRange&&(this.current.dates=2===this.current.dateRange.length?this.current.dateRange.map(o=>(0,z.Z)(o,"yyyy-MM-dd")):null),this.http.post("/hello/selectappstaffclockloglist",t).subscribe(({data:o})=>{this.logList=o||[],this.title=`${t.username} - \u6253\u5361\u8bb0\u5f55`,this.isLogVisible=!0})}handleLogCancel(){this.isLogVisible=!1,this.current.dateRange=null,this.current.dates=null}handleDeviCancel(){this.isDeviVisible=!1}handleLogOk(){this.isLogVisible=!1,this.current.dateRange=null,this.current.dates=null}handleDeviOk(){this.isDeviVisible=!1}openAddr(){this.isAddrVisible=!0}openJob(){const t=this.users.filter(({userNo:o})=>!!o).filter(({userNo:o})=>this.setOfCheckedId.has(o));this.title="",t.forEach(({userNo:o,username:i,addr:l})=>{this.title+=`${o} - ${i} - ${l.address};`}),this.isJobVisible=!0}pauseJob(){this.http.get("/hello/pausejob").subscribe(({status:t,message:o})=>{1===t?this.notificationService.success("\u64cd\u4f5c\u63d0\u793a",o):this.notificationService.error("\u64cd\u4f5c\u63d0\u793a",o)})}resumeJob(){this.http.get("/hello/resumejob").subscribe(({status:t,message:o})=>{1===t?this.notificationService.success("\u64cd\u4f5c\u63d0\u793a",o):this.notificationService.error("\u64cd\u4f5c\u63d0\u793a",o)})}submitAddrForm(t){for(const o in this.validateAddrForm.controls)this.validateAddrForm.controls.hasOwnProperty(o)&&(this.validateAddrForm.controls[o].markAsDirty(),this.validateAddrForm.controls[o].updateValueAndValidity());this.validateAddrForm.valid&&(t.id=this.addresses.length+1,this.addresses.push(t),this.resetAddrForm(),this.isAddrVisible=!1)}submitJobForm(t){for(const o in this.validateJobForm.controls)this.validateJobForm.controls.hasOwnProperty(o)&&(this.validateJobForm.controls[o].markAsDirty(),this.validateJobForm.controls[o].updateValueAndValidity());if(this.validateJobForm.valid){const i={users:this.users.filter(({userNo:l})=>!!l).filter(({userNo:l})=>this.setOfCheckedId.has(l)).map(l=>{const c={...l,...l.addr};return c.addr=null,c.staffClock=null,c}),cronExpression:t.cronExpression};this.http.post("/hello/savejob",i).subscribe(({status:l,message:c})=>{1===l?(this.notificationService.success("\u64cd\u4f5c\u63d0\u793a",c),setTimeout(()=>{this.setOfCheckedId.clear(),this.refreshCheckedStatus(),this.resetJobForm(),this.isJobVisible=!1},1e3)):this.notificationService.error("\u64cd\u4f5c\u63d0\u793a",c)})}}resetAddrForm(){this.isAddrVisible=!1,this.validateAddrForm.reset();for(const t in this.validateAddrForm.controls)this.validateAddrForm.controls.hasOwnProperty(t)&&(this.validateAddrForm.controls[t].markAsPristine(),this.validateAddrForm.controls[t].updateValueAndValidity())}resetJobForm(){this.isJobVisible=!1,this.validateJobForm.reset();for(const t in this.validateJobForm.controls)this.validateJobForm.controls.hasOwnProperty(t)&&(this.validateJobForm.controls[t].markAsPristine(),this.validateJobForm.controls[t].updateValueAndValidity())}onAllChecked(t){this.users.forEach(({userNo:o})=>this.updateCheckedSet(o,t)),this.refreshCheckedStatus()}updateCheckedSet(t,o){o?this.setOfCheckedId.add(t):this.setOfCheckedId.delete(t)}refreshCheckedStatus(){this.checked=this.users.every(({userNo:t})=>this.setOfCheckedId.has(t)),this.indeterminate=this.users.some(({userNo:t})=>this.setOfCheckedId.has(t))&&!this.checked}onItemChecked(t,o){this.updateCheckedSet(t,o),this.refreshCheckedStatus()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(v.eN),e.Y36(F.dD),e.Y36(x.zb),e.Y36(a.QS),e.Y36(J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-welcome"]],decls:44,vars:19,consts:[["nz-button","","nzType","primary",3,"click"],["nzType","vertical"],["nz-button","","nzType","primary",3,"disabled","click"],["nzType","horizontal"],[3,"nzData","nzFrontPagination","nzShowPagination"],["basicTable",""],["nzWidth","30px",3,"nzChecked","nzIndeterminate","nzCheckedChange"],["nzWidth","120px"],["nzWidth","200px"],["nzWidth","190px"],["nzWidth","210px"],["nzWidth","280px"],[4,"ngFor","ngForOf"],["nzTitle","\u5b9a\u65f6\u4efb\u52a1","nzWidth","400px",3,"nzVisible","nzMaskClosable","nzOkDisabled","nzVisibleChange","nzOnCancel","nzOnOk"],[4,"nzModalContent"],["nzTitle","\u516c\u53f8\u5730\u5740","nzWidth","400px",3,"nzVisible","nzMaskClosable","nzOkDisabled","nzVisibleChange","nzOnCancel","nzOnOk"],["nzWidth","1440px",3,"nzVisible","nzTitle","nzFooter","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"nzChecked","nzCheckedChange"],["nz-input","","placeholder","\u5458\u5de5\u7f16\u53f7",3,"ngModel","ngModelChange",4,"ngIf","ngIfElse"],["userno",""],["nz-input","","placeholder","\u5458\u5de5\u59d3\u540d",3,"ngModel","ngModelChange",4,"ngIf","ngIfElse"],["username",""],[2,"width","200px",3,"ngModel","nzDropdownMatchSelectWidth","compareWith","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["clockworkonstatus",""],["clockworkoffstatus",""],["nzShowTime","","nzInputReadOnly","","nzBackdrop","","nzMode","date",3,"ngModel","ngModelChange"],["elseBlock",""],["nz-input","","placeholder","\u5458\u5de5\u7f16\u53f7",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf","ngIfElse"],["elseBlockChild",""],[3,"click"],["nz-input","","placeholder","\u5458\u5de5\u59d3\u540d",3,"ngModel","ngModelChange"],[3,"nzLabel","nzValue"],["nzColor","green",4,"ngIf","ngIfElse"],["clockworkonstatusChild",""],["nzColor","green"],["nzColor","red"],["clockworkoffstatusChild",""],["nz-button","","nzType","primary","nzDanger","",3,"click"],["nzType","error","nzShowIcon","",3,"nzMessage"],["nz-form","",3,"formGroup"],["nzRequired",""],["nzHasFeedback","",3,"nzErrorTip"],["nz-input","","formControlName","cronExpression","placeholder","\u8bf7\u8f93\u5165cron\u8868\u8fbe\u5f0f"],["cronErrorTpl",""],[4,"ngIf"],["formControlName","longitude","nzPlaceHolder","\u8bf7\u8f93\u5165\u7ecf\u5ea6","nzPrecisionMode","cut",2,"width","100%",3,"nzPrecision","nzMin"],["longitudeErrorTpl",""],["formControlName","latitude","nzPlaceHolder","\u8bf7\u8f93\u5165\u7eac\u5ea6","nzPrecisionMode","cut",2,"width","100%",3,"nzPrecision","nzMin"],["latitudeErrorTpl",""],["nz-input","","formControlName","address","placeholder","\u8bf7\u8f93\u5165\u5730\u5740"],["addressErrorTpl",""],["nzSize","small",3,"nzData","nzScroll","nzFrontPagination","nzShowPagination"],["nzWidth","50px"],["nzWidth","100px"],["nzBackdrop","","nzInputReadOnly","","nzMode","date",3,"ngModel","ngModelChange"],["nzSize","small","nzShowPagination","","nzShowQuickJumper","","nzShowSizeChanger","",3,"nzData","nzScroll"]],template:function(t,o){if(1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return o.openUser()}),e._uU(1,"\u6dfb\u52a0\u5458\u5de5"),e.qZA(),e._UZ(2,"nz-divider",1),e.TgZ(3,"button",0),e.NdJ("click",function(){return o.openAddr()}),e._uU(4,"\u6dfb\u52a0\u5730\u5740"),e.qZA(),e._UZ(5,"nz-divider",1),e.TgZ(6,"button",2),e.NdJ("click",function(){return o.openJob()}),e._uU(7,"\u521b\u5efa|\u66f4\u65b0\u5b9a\u65f6\u4efb\u52a1"),e.qZA(),e._UZ(8,"nz-divider",1),e.TgZ(9,"button",0),e.NdJ("click",function(){return o.pauseJob()}),e._uU(10,"\u6682\u505c\u5b9a\u65f6\u4efb\u52a1"),e.qZA(),e._UZ(11,"nz-divider",1),e.TgZ(12,"button",0),e.NdJ("click",function(){return o.resumeJob()}),e._uU(13,"\u6062\u590d\u5b9a\u65f6\u4efb\u52a1"),e.qZA(),e._UZ(14,"nz-divider",3),e.TgZ(15,"nz-table",4,5)(17,"thead")(18,"tr")(19,"th",6),e.NdJ("nzCheckedChange",function(l){return o.onAllChecked(l)}),e.qZA(),e.TgZ(20,"th",7),e._uU(21,"\u7f16\u53f7"),e.qZA(),e.TgZ(22,"th",7),e._uU(23,"\u59d3\u540d"),e.qZA(),e.TgZ(24,"th",8),e._uU(25,"\u5730\u5740"),e.qZA(),e.TgZ(26,"th",9),e._uU(27,"\u4e0a\u73ed"),e.qZA(),e.TgZ(28,"th",9),e._uU(29,"\u4e0b\u73ed"),e.qZA(),e.TgZ(30,"th",10),e._uU(31,"\u65e5\u671f"),e.qZA(),e.TgZ(32,"th",11),e._uU(33,"\u64cd\u4f5c"),e.qZA()()(),e.TgZ(34,"tbody"),e.YNc(35,oe,27,16,"tr",12),e.qZA()(),e.TgZ(36,"nz-modal",13),e.NdJ("nzVisibleChange",function(l){return o.isJobVisible=l})("nzOnCancel",function(){return o.resetJobForm()})("nzOnOk",function(){return o.submitJobForm(o.validateJobForm.value)}),e.YNc(37,re,11,3,"ng-container",14),e.qZA(),e.TgZ(38,"nz-modal",15),e.NdJ("nzVisibleChange",function(l){return o.isAddrVisible=l})("nzOnCancel",function(){return o.resetAddrForm()})("nzOnOk",function(){return o.submitAddrForm(o.validateAddrForm.value)}),e.YNc(39,pe,23,8,"ng-container",14),e.qZA(),e.TgZ(40,"nz-modal",16),e.NdJ("nzVisibleChange",function(l){return o.isDeviVisible=l})("nzOnCancel",function(){return o.handleDeviCancel()})("nzOnOk",function(){return o.handleDeviOk()}),e.YNc(41,ge,29,6,"ng-container",14),e.qZA(),e.TgZ(42,"nz-modal",16),e.NdJ("nzVisibleChange",function(l){return o.isLogVisible=l})("nzOnCancel",function(){return o.handleLogCancel()})("nzOnOk",function(){return o.handleLogOk()}),e.YNc(43,ze,28,5,"ng-container",14),e.qZA()),2&t){const i=e.MAs(16);e.xp6(6),e.Q6J("disabled",0===o.setOfCheckedId.size),e.xp6(9),e.Q6J("nzData",o.users)("nzFrontPagination",!1)("nzShowPagination",!1),e.xp6(4),e.Q6J("nzChecked",o.checked)("nzIndeterminate",o.indeterminate),e.xp6(16),e.Q6J("ngForOf",i.data),e.xp6(1),e.Q6J("nzVisible",o.isJobVisible)("nzMaskClosable",!1)("nzOkDisabled",!o.validateJobForm.valid),e.xp6(2),e.Q6J("nzVisible",o.isAddrVisible)("nzMaskClosable",!1)("nzOkDisabled",!o.validateAddrForm.valid),e.xp6(2),e.Q6J("nzVisible",o.isDeviVisible)("nzTitle",o.title)("nzFooter",null),e.xp6(2),e.Q6J("nzVisible",o.isLogVisible)("nzTitle",o.title)("nzFooter",null)}},dependencies:[C.sg,C.O5,a._Y,a.Fj,a.JJ,a.JL,a.On,a.sg,a.u,T.du,T.Hf,Z.t3,Z.SK,m.Lr,m.Nx,m.iK,m.Fd,u.N8,u.Uo,u._C,u.h7,u.Om,u.p0,u.$Z,u.g6,q._V,b.Ip,b.Vq,k.uw,k.wS,M.ix,U.w,E.dQ,N.Zp,y.g,B.r,D.j],styles:[".ant-tag[_ngcontent-%COMP%]{font-size:14px}"]}),n})()}];let Te=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.Bz.forChild(Ce),g.Bz]}),n})();var Ze=r(9983);let be=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[Te,Ze.m]}),n})()}}]);