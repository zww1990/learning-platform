<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
		<title>hello</title>
		<link rel="icon" type="image/x-icon" href="favicon.ico">
		<link href="roboto/css.css" rel="stylesheet">
		<link href="font/css/materialdesignicons.min.css" rel="stylesheet">
		<link href="vuetify/vuetify.min.css" rel="stylesheet">
	</head>
	<body>
		<div id="app">
			<v-app>
			  <v-main>
				<v-container>
		          <template v-for="(user, i) in users">
					  <v-row>
			            <v-col class="mt-2" cols="2">
			              <v-select v-model="user.addr" :items="addresses" item-text="address" item-value="id" label="公司地址"
			               return-object></v-select>
			              <v-btn large depressed color="primary" @click="clickme(i)">{{user.username}}</v-btn>
			            </v-col>
			            <v-col v-if="user.type != null">
			              <v-alert :type="user.type"><span v-html="user.message"></span></v-alert>
			            </v-col>
			            <v-col></v-col>
			            <v-col></v-col>
			          </v-row>
		          </template>
				</v-container>
			  </v-main>
			</v-app>
		</div>
	</body>
	<script src="vue/vue.min.js"></script>
	<script src="vuetify/vuetify.min.js"></script>
	<script type="text/javascript">
		new Vue({
			el:'#app',
			vuetify: new Vuetify({
				theme: { dark: true },
			}),
			data:{
				users: [
					{userNo:'100245', password:'123456', username:'王哲',  type:null, message:'', addr:{ id:1 }},
					{userNo:'100232', password:'123456', username:'李米盛', type:null, message:'', addr:{ id:1 }},
					{userNo:'100226', password:'123456', username:'刘常富', type:null, message:'', addr:{ id:1 }},
					{userNo:'100246', password:'123456', username:'李贺彦', type:null, message:'', addr:{ id:1 }},
					{userNo:'100627', password:'123456', username:'关晓鹏', type:null, message:'', addr:{ id:1 }},
					{userNo:'100230', password:'123456', username:'张维维', type:null, message:'', addr:{ id:1 }},
					{userNo:'100261', password:'123456', username:'张东丽', type:null, message:'', addr:{ id:1 }},
				],
				addresses:[
					{id:1, address:'北京市海淀区花园东路11号', longitude:"116.3690760", latitude:"39.9802720"},
					{id:2, address:'石家庄海河道168号',     longitude:"114.6222430", latitude:"38.0476450"},
				]
			},
			created: function(){
			},
			mounted: function(){
				this.users.forEach(user => {
					let addr = this.addresses.find(ad => user.addr.id === ad.id);
					fetch('/hello/initStaffClock',{
						  method: 'POST',
						  body: JSON.stringify({...user, ...addr}),
						  headers: new Headers({
						    'Content-Type': 'application/json'
						  })
					})
					.then(res => res.json())
					.then(res => {
						console.log('Success:', res);
						user.type = res.status === 1 ? 'info' : 'error';
						user.message = res.status !== 1 ? res.message : 
							`地点：${res.data.address}<br>
							经度：${res.data.longitude}<br>
							纬度：${res.data.latitude}<br>
							上班打卡时间：${res.data.clockTimeMin || ''}<br>
							上班打卡状态：${res.data.clockWorkOnStatusName || ''}<br>
							下班打卡时间：${res.data.clockTimeMax || ''}<br>
							下班打卡状态：${res.data.clockWorkOffStatusName || ''}<br>`;
					});
				});
			},
			methods: {
				clickme(index){
					let user = this.users[index];
					let addr = this.addresses.find(ad => user.addr.id === ad.id);
					fetch('/hello/userLoginAndStaffClock', {
						  method: 'POST',
						  body: JSON.stringify({...user, ...addr}),
						  headers: new Headers({
						    'Content-Type': 'application/json'
						  })
					})
					.then(res => res.json())
					.then(res => {
						console.log('Success:', res);
						user.type = res.status === 1 ? 'success' : 'error';
						user.message = res.status !== 1 ? res.message : 
							`地点：${res.data.address}<br>
							经度：${res.data.longitude}<br>
							纬度：${res.data.latitude}<br>
							上班打卡时间：${res.data.clockTimeMin || ''}<br>
							上班打卡状态：${res.data.clockWorkOnStatusName || ''}<br>
							下班打卡时间：${res.data.clockTimeMax || ''}<br>
							下班打卡状态：${res.data.clockWorkOffStatusName || ''}<br>`;
					});
				}
		    }
		})
	</script>
</html>
